= Road to RubyKaigi:\nMaking Tinny Chiptunes with Ruby

: author
   @makicamel

: content-source
   RubyKaigi 2025

:date
   2025.04.17

:theme
   theme

= è‡ªå·±ç´¹ä»‹

  * @makicamel / å·åŸä¸‡å­£
  * Ruby ğŸ’ ã¨ãƒ“ãƒ¼ãƒ« ğŸ» ã¨ãŠé…’ãŒå¥½ã
  * ãˆ±ã‚¢ãƒ³ãƒ‰ãƒ‘ãƒƒãƒ‰
  * "Road to RubyKaigi" ã®ä½œè€…

  # image
  # src = image/makicamel.png
  # relative_width = 10
  # align = right
  # vertical_align = top
  # relative_margin_right = 0
  # relative_margin_top = 0

= Road to RubyKaigi
ã€€
  # image
  # src = image/road_to_rubykaigi-github.png
  # relative_height = 100
  # align = center
  # vertical_align = top
  # relative_margin_right = 0
  # relative_margin_top = -8

(('tag:xx-small:ã€€ã€€Road to RubyKaigiã€€'))((<URL:https://github.com/makicamel/road_to_rubykaigi>))

= Road to RubyKaigi

  * Rubyist ã«ã‚ˆã‚‹ Rubyist ã®ãŸã‚ã® Ruby è£½ã®ã‚²ãƒ¼ãƒ 
  * ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§éŠã¶æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ 
  * ãƒã‚°ã‚’å€’ã—ã€†åˆ‡ã‹ã‚‰é€ƒã‚Œã¦ RubyKaigi å‚åŠ ã‚’ç›®æŒ‡ã™
  * `gem install road_to_rubykaigi`

= Road to RubyKaigi

  * ãƒ—ãƒ¬ã‚¤å‹•ç”»

  # image
  # src = image/play-video.gif
  # relative_height = 100
  # align = center
  # vertical_align = middle

= Road to RubyKaigi

  * ãªã«ã‹ãŒè¶³ã‚Šãªã„
  * (('wait'))éŸ³æ¥½!

= éŸ³

  * macOS ã«ã¯æ¨™æº–ã§ä½¿ãˆã‚‹éŸ³æºãŒãªã„
    * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã‚‹
    * ãµã¹ã‚“

= ã“ã“ã§ä¸€å¥
ã€€
= ã“ã“ã§ä¸€å¥

  # image
  # src = image/haiku.png
  # relative_height = 92
  # align = center
  # vertical_align = middle

= éŸ³æ¥½ã‚’ã¤ãã‚‹

  * éŸ³ã¨ã¯æ³¢

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/waveform-example.png
: background-image-relative-width
   90
: background-image-vertical-align
   top
: background-image-relative-margin-top
   40

= éŸ³æ¥½ã‚’ã¤ãã‚‹

  * æ³¢ã‚’ã¤ãã‚‹ã‚‚ã®ãŒéŸ³æº
    * Ruby ãŒéŸ³æº

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/waveform-example.png
: background-image-relative-width
   90
: background-image-vertical-align
   top
: background-image-relative-margin-top
   40

= éŸ³æ¥½ã‚’ã¤ãã‚‹

  * ã¤ãã£ãŸæ³¢ã‚’å‡ºåŠ›ã™ã‚‹è£…ç½®
    * ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹
      * e.g. ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã€ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³

= éŸ³æ¥½ã‚’ã¤ãã‚‹

  * ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹ã®å…¥å‡ºåŠ› API
    * macOS
      * Core Audio
    * Windows
      * Windows Audio Session API
    * Linux
      * Advanced Linux Sound Architecture

  # image
  # src = image/fukidashi-multi-platforms.png
  # relative_width = 30
  # align = right
  # vertical_align = bottom
  # relative_margin_top = 12

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/makicamel.png
: background-image-relative-width
   9
: background-image-align
   right
: background-image-vertical-align
   bottom
: background-image-relative-margin-right
   6

= éŸ³æ¥½ã‚’ã¤ãã‚‹

* ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå…¥å‡ºåŠ› API æä¾›ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  * PortAudio ((<URL:https://github.com/PortAudio/portaudio>))
* (('wait'))PortAudio ã® Ruby ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
  * ffi-portaudio ((<URL:https://github.com/nanki/ffi-portaudio>))

= éŸ³æ¥½ã‚’ã¤ãã‚‹

  (1) æ³¢ï¼ˆéŸ³ãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’ã¤ãã‚‹
  (2) ffi-portaudio ã«æ¸¡ã™
      * PortAudio çµŒç”±ã§ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹ã«å‡ºåŠ›ã™ã‚‹
  (3) Ruby ã§éŸ³ã‚’é³´ã‚‰ã›ã‚‹

  # image
  # src = image/fukidashi-music.png
  # relative_width = 30
  # align = right
  # vertical_align = bottom
  # relative_margin_top = 12

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/makicamel.png
: background-image-relative-width
   9
: background-image-align
   right
: background-image-vertical-align
   bottom
: background-image-relative-margin-right
   6

= ã€€
ã€€
== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/wave.jpg
: background-image-relative-width
   100
: background-image-align
   center
: background-image-vertical-align
   bottom
: background-image-relative-margin-top
   6

= æ³¢ã®ã¤ãã‚Šæ–¹: åŸºæœ¬

  * "éŸ³ã¨ã¯æ³¢"
    * ã¨ã¯ï¼Ÿ

= æ³¢ã®ã¤ãã‚Šæ–¹: åŸºæœ¬

  * ä»£è¡¨çš„ãªæ³¢å½¢
    * ã‚µã‚¤ãƒ³æ³¢
    * çŸ©å½¢æ³¢
    * ä¸‰è§’æ³¢
    * ãƒã‚³ã‚®ãƒªæ³¢

\n\n\n
(('tag:xx-small:ã€€ã€€Square wave (waveform)ã€€'))((<URL:https://en.wikipedia.org/wiki/Square_wave_(waveform)>))

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/waveforms-wiki.png
: background-image-relative-height
   68
: background-image-align
   right
: background-image-vertical-align
   middle
: background-image-relative-margin-right
   6

= æ³¢ã®ã¤ãã‚Šæ–¹: åŸºæœ¬

  * å‘¨æœŸæ€§ã‚’æŒã¤
    * ä¿¡å·ã®å¼·ã•ã®å¤‰åŒ–ã«\nãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹
  * å‘¨æ³¢æ•°
    * 1 ç§’é–“ã«å‘¨æœŸã‚’ç¹°ã‚Šè¿”ã™å›æ•°
      * e.g. 444.0Hz ã®å ´åˆ
        * æ¯ç§’ 440 å‘¨æœŸã‚’ç¹°ã‚Šè¿”ã™

  # image
  # src = image/waveforms-wiki-cycle.png
  # relative_height = 84
  # align = right
  # vertical_align = top
  # relative_margin_right = 42
  # relative_padding_top = -4

\n
(('tag:xx-small:ã€€ã€€Square wave (waveform)ã€€'))((<URL:https://en.wikipedia.org/wiki/Square_wave_(waveform)>))

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/waveforms-wiki.png
: background-image-relative-height
   68
: background-image-align
   right
: background-image-vertical-align
   middle
: background-image-relative-margin-right
   6

= æ³¢ã®ã¤ãã‚Šæ–¹: åŸºæœ¬

  * å‘¨æœŸ
    * 1 å‘¨æœŸã«ã‹ã‹ã‚‹æ™‚é–“

  # image
  # src = image/waveforms-wiki-cycle.png
  # relative_height = 84
  # align = right
  # vertical_align = top
  # relative_margin_right = 42
  # relative_padding_top = -4

\n\n\n\n\n\n\n
(('tag:xx-small:ã€€ã€€Square wave (waveform)ã€€'))((<URL:https://en.wikipedia.org/wiki/Square_wave_(waveform)>))

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/waveforms-wiki.png
: background-image-relative-height
   68
: background-image-align
   right
: background-image-vertical-align
   middle
: background-image-relative-margin-right
   6

= æ³¢ã®ã¤ãã‚Šæ–¹: åŸºæœ¬

  * ã‚¢ãƒŠãƒ­ã‚°
    * å‘¨æœŸã®ä¸­ã§ä¿¡å·ã®å¼·ã•ãŒé€£ç¶šã—ã¦å¤‰åŒ–ã™ã‚‹
  * ãƒ‡ã‚¸ã‚¿ãƒ«
    * é€£ç¶šã—ãŸä¿¡å·ã®è¨˜éŒ²ã¯ã§ããªã„
    * é€£ç¶šã—ã¦è¦‹ãˆã‚‹ã‚ˆã†è¦å®šå›æ•°è¨˜éŒ²ã™ã‚‹
      * ã“ã®è¦å®šå›æ•°ãŒã€Œã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆã€
    * ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆ
      * 1 ç§’é–“ã«å–å¾—ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«æ•°

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/waveform-dac.png
: background-image-relative-width
   50
: background-image-align
   right
: background-image-vertical-align
   bottom
: background-image-relative-margin-right
   2
: background-image-relative-padding-bottom
   4

= æ³¢ã®ã¤ãã‚Šæ–¹: åŸºæœ¬

  * æ³¢ã®ã¤ãã‚Šæ–¹
    * ä¿¡å·ã®å¤‰åŒ–ã‚’é›†ã‚ã¦ç¹°ã‚Šè¿”ã™ã ã‘

= ã€€
ã€€
== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/wave2.jpg
: background-image-relative-width
   100
: background-image-align
   center
: background-image-vertical-align
   bottom
: background-image-relative-margin-top
   10

= æ³¢ã®ã¤ãã‚Šæ–¹: å®Ÿè·µ

  * ãƒ•ã‚¡ãƒŸã‚³ãƒ³ã®ã‚ˆã†ãªãƒ”ã‚³ãƒ”ã‚³éŸ³ã‚’é³´ã‚‰ã—ãŸã„
  * ãƒ•ã‚¡ãƒŸã‚³ãƒ³ã§ç”Ÿæˆã•ã‚Œã‚‹æ³¢å½¢
    * çŸ©å½¢æ³¢
    * ä¸‰è§’æ³¢
  * ä»Šå›ã¯çŸ©å½¢æ³¢ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—

= æ³¢ã®ã¤ãã‚Šæ–¹: çŸ©å½¢æ³¢

  * 1 ã¨ -1 ã® 2 å€¤
  * ã„ã‚ã‚†ã‚‹ãƒ”ã‚³ãƒ”ã‚³éŸ³

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/waveform-square.png
: background-image-relative-width
   68
: background-image-align
   center
: background-image-vertical-align
   middle
: background-image-relative-margin-top
   10

= æ³¢ã®ã¤ãã‚Šæ–¹: çŸ©å½¢æ³¢

  * å‘¨æœŸå‰åŠãŒ 1ã€å¾ŒåŠãŒ -1

  # image
  # src = image/fukidashi-easy.png
  # relative_width = 30
  # align = right
  # vertical_align = bottom
  # relative_margin_top = 12

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/makicamel.png
: background-image-relative-width
   9
: background-image-align
   right
: background-image-vertical-align
   bottom
: background-image-relative-margin-right
   6

= æ³¢ã®ã¤ãã‚Šæ–¹: çŸ©å½¢æ³¢

  * å‘¨æœŸ
    * å‘¨æ³¢æ•°: 1 ç§’ã«å‘¨æœŸã‚’ç¹°ã‚Šè¿”ã™å›æ•°
    * ã‚µãƒ³ãƒ—ãƒ«ã‚ãŸã‚Šã®æ™‚é–“: 1 ç§’ / ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆ
    * ã‚µãƒ³ãƒ—ãƒ«ã‚ãŸã‚Šç¾åœ¨ä½ç½®ã®å¢—åˆ†: å‘¨æ³¢æ•° / ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆ

  # rouge ruby
    class SquareOscillator
      def tick(frequency:)
          @phase += frequency.to_f / sample_rate
          @phase -= 1.0 if @phase >= 1.0 # å‘¨æœŸã¯0ã€œ1ãªã®ã§1ã«åˆ°é”ã—ãŸã‚‰-1ã™ã‚‹
          @phase
      end

= æ³¢ã®ã¤ãã‚Šæ–¹: çŸ©å½¢æ³¢

  * æ³¢å½¢ç”Ÿæˆ

      # rouge ruby
        class SquareOscillator
            # ...
            def generate(frequency:)
                # å‘¨æœŸã®ä¸­ã®ç¾åœ¨åœ°ã‚’å–å¾—
                phase = tick(frequency: frequency)
                # å‘¨æœŸå‰åŠãªã‚‰1ã€å¾ŒåŠãªã‚‰-1ã‚’è¿”ã™
                phase < 0.5 ? 1.0 : -1.0
            end
        end

  * ä¿¡å·ã‚’é›†ã‚ã‚‹ã¨çŸ©å½¢æ³¢ãŒã§ãã‚‹

= æ³¢ã®ã¤ãã‚Šæ–¹: çŸ©å½¢æ³¢

  * PortAudioã«æ¸¡ã™

      # rouge ruby
      class AudioEngine < FFI::PortAudio::Stream
          def process(_input, output, framesPerBuffer, _timeInfo, _statusFlags, _userData)
              samples = (0...framesPerBuffer).map { @oscillator.generate(frequency:) }
              output.write_array_of_float(samples)
              :paContinue
          end
      # ...
  * (('wait'))éŸ³ãŒé³´ã£ãŸ ğŸ‰

= æ³¢ã®ã¤ãã‚Šæ–¹: çŸ©å½¢æ³¢
ã€€
  * ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹æ³¢å½¢

  # image
  # src = image/waveform-square-1.png
  # relative_width = 80
  # align = right
  # vertical_align = middle

= æ³¢ã®ã¤ãã‚Šæ–¹: çŸ©å½¢æ³¢
ã€€
  * ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹æ³¢å½¢

  # image
  # src = image/waveform-square-2.png
  # relative_width = 80
  # align = right
  # vertical_align = middle

= æ³¢ã®ã¤ãã‚Šæ–¹: çŸ©å½¢æ³¢
ã€€
  # image
  # src = image/fukidashi-noise.png
  # relative_width = 40
  # align = right
  # vertical_align = bottom
  # relative_margin_top = 12

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/makicamel.png
: background-image-relative-width
   9
: background-image-align
   right
: background-image-vertical-align
   bottom
: background-image-relative-margin-right
   6

= æ³¢ã®ã¤ãã‚Šæ–¹: ç™ºå±•

  * æ€¥æ¿€ã«ä¿¡å·ã®å¼·ã•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ãƒã‚¤ã‚ºãŒç”Ÿã¾ã‚Œã‚‹
    * å¤šãã®é«˜å‘¨æ³¢æˆåˆ†ãŒç”Ÿã¾ã‚Œã‚‹
    * ãƒ‡ã‚¸ã‚¿ãƒ« â†’ ã‚¢ãƒŠãƒ­ã‚°ã®å¤‰æ›

= æ³¢ã®ã¤ãã‚Šæ–¹: ç™ºå±•

  * ãƒã‚¤ã‚ºé™¤å»
    * è§’ä¸¸ã«ã™ã‚‹
\n\n\n\n\n\n\n
(('tag:xx-small:ã€€ã€€æ€¥æ¿€ãªä¿¡å·ã®å¤‰åŒ–ã«ã‚ˆã‚‹ãƒã‚¤ã‚ºé™¤å»ã«ã¯ãƒ•ã‚£ãƒ«ã‚¿ãŒåŠ¹æœçš„ã§ã™ãŒ'))\n
(('tag:xx-small:ã€€ã€€ä»Šå›ã¯ãƒ”ã‚³ãƒ”ã‚³éŸ³ã«ã—ãŸã„ã®ã§æ¡ç”¨ã—ã¾ã›ã‚“'))

= æ³¢ã®ã¤ãã‚Šæ–¹: ç™ºå±•

  * å‘¨æœŸã®ä¸­ã®ç¾åœ¨ä½ç½®ãŒè§’ã®ä»˜è¿‘ã®å ´åˆã€ä¿¡å·ã®å¼·ã•ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’ã¤ã‘ã‚‹

  # image
  # src = image/waveform-square-2.png
  # relative_width = 80
  # align = right
  # vertical_align = middle

= æ³¢ã®ã¤ãã‚Šæ–¹: ç™ºå±•

    * å‘¨æœŸã®ä¸­ã®ç¾åœ¨ä½ç½®ãŒè§’ã®ä»˜è¿‘ã®å ´åˆã€ä¿¡å·ã®å¼·ã•ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’ã¤ã‘ã‚‹
      * ã“ã‚“ãªã‚«ãƒ¼ãƒ–ã‚’æãã‚ˆã†ã‚³ã‚µã‚¤ãƒ³é–¢æ•°ã‚’ä½¿ã†

  # image
  # src = image/waveform-square-5.png
  # relative_width = 80
  # align = right
  # vertical_align = middle

= æ³¢ã®ã¤ãã‚Šæ–¹: ç™ºå±•

  * ãã‚Œã„ã«ãªã£ãŸ ğŸ™Œ

  # image
  # src = image/waveform-square-4.png
  # relative_height = 96
  # align = center
  # vertical_align = middle

= éŸ³æ¥½ã‚’é³´ã‚‰ã™

  * ã‚ã¨ã¯è­œé¢ã‚’æ›¸ã„ã¦

== ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

: background-image
   image/score.png
: background-image-relative-height
   92
: background-image-align
   center
: background-image-vertical-align
   top
: background-image-relative-margin-top
   32

= éŸ³æ¥½ã‚’é³´ã‚‰ã™

  * ã„ã‚ã„ã‚çµ„ã¿åˆã‚ã›ã¦
    * ä¸‰è§’æ³¢
      * æ“¬ä¼¼ä¸‰è§’æ³¢
    * ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—
    * åŠ¹æœéŸ³

= éŸ³æ¥½ã‚’é³´ã‚‰ã™

  * PortAudio ã«æ¸¡ã›ã°å®Œæˆ

      # rouge ruby
      class AudioEngine < FFI::PortAudio::Stream
          def process(_input, output, framesPerBuffer, _timeInfo, _statusFlags, _userData)
              samples = (0...framesPerBuffer).map { @oscillator.generate(frequency:) }
              output.write_array_of_float(samples)
              :paContinue
          end
      # ...

= ãƒ‡ãƒ¢ ğŸ”ˆ

= Special Thanks

* @youchan

= Enjoy Creating!
